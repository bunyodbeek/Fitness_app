{% extends 'base.html' %}
{% load static %}

{% block title %}All Workouts{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'apps/style/custom_program_list_style.css' %}">
{% endblock %}

{% block content %}
    <!-- Header -->
    <div class="page-header">
        <button class="back-btn" onclick="window.history.back()">‚Äπ</button>
        <h1 class="page-title">WORKOUTS</h1>
    </div>

    <div class="container">
        {% if programs %}
            {% for program in programs %}
                <a href="{% url 'program_detail' program.id %}" class="program-card">
                    <div class="program-header">
                        {% if program.image %}
                            <img src="{{ program.image.url }}" alt="{{ program.title }}" class="program-image">
                        {% else %}
                            <img src="https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=800&q=80"
                                 alt="{{ program.title }}" class="program-image">
                        {% endif %}

                        <button class="program-favorite"
                                onclick="event.preventDefault(); event.stopPropagation(); toggleFavorite({{ program.id }}, this)">
                            ‚òÜ
                        </button>

                        <div class="program-title-overlay">
                            <h2>{{ program.title }}</h2>
                            <p>üéØ {{ program.editions.count }} Edition{{ program.editions.count|pluralize }}</p>
                        </div>
                    </div>

                    <div class="program-info">
                        <p class="program-description">
                            {{ program.description|default:"Transform your body with this comprehensive workout program designed for all fitness levels."|truncatewords:20 }}
                        </p>

                        <div class="program-meta">
                    <span class="meta-item">
                        üìÖ {{ program.editions.first.duration_weeks|default:"8" }} weeks
                    </span>
                            <span class="meta-item">
                        üèãÔ∏è {{ program.editions.first.days_per_week|default:"3" }} days/week
                    </span>
                            <span class="meta-item">
                        üí™ {{ program.exercises_count|default:"30" }} exercises
                    </span>
                        </div>
                    </div>
                </a>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üèãÔ∏è</div>
                <h3>Hozircha dasturlar yo'q</h3>
                <p>Tez orada yangi dasturlar qo'shiladi</p>
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block extra_js %}
    <script>
        function toggleFavorite(programId, button) {
            console.log('Favorite toggled for program:', programId);

            // Toggle active class
            button.classList.toggle('active');

            // Change icon
            if (button.classList.contains('active')) {
                button.innerHTML = '‚òÖ';
            } else {
                button.innerHTML = '‚òÜ';
            }

            // AJAX so'rov yuborish (keyinchalik qo'shamiz)
            fetch(`/favorite/toggle/${programId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
        }

    </script>
{% endblock %}